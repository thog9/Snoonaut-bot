import os
import sys
import asyncio
from colorama import init, Fore, Style
import inquirer

# Khá»Ÿi táº¡o colorama
init(autoreset=True)

# Äá»™ rá»™ng viá»n cá»‘ Ä‘á»‹nh
BORDER_WIDTH = 80

# HÃ m hiá»ƒn thá»‹ viá»n Ä‘áº¹p máº¯t
def print_border(text: str, color=Fore.CYAN, width=BORDER_WIDTH):
    text = text.strip()
    if len(text) > width - 4:
        text = text[:width - 7] + "..."  # Cáº¯t dÃ i vÃ  thÃªm "..."
    padded_text = f" {text} ".center(width - 2)
    print(f"{color}â”Œ{'â”€' * (width - 2)}â”{Style.RESET_ALL}")
    print(f"{color}â”‚{padded_text}â”‚{Style.RESET_ALL}")
    print(f"{color}â””{'â”€' * (width - 2)}â”˜{Style.RESET_ALL}")

# HÃ m hiá»ƒn thá»‹ banner
def _banner():
    banner = r"""


â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—â–‘â–‘â–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ•—â–‘â–‘â–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ•—â–‘â–‘â–‘â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â€ƒâ€ƒâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â€ƒâ€ƒâ–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•
â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â€ƒâ€ƒâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•¦â•â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘
â–‘â•šâ•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â€ƒâ€ƒâ–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–‘â•šâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–‘â•šâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â€ƒâ€ƒâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•¦â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘
â•šâ•â•â•â•â•â•â–‘â•šâ•â•â–‘â–‘â•šâ•â•â•â–‘â•šâ•â•â•â•â•â–‘â–‘â•šâ•â•â•â•â•â–‘â•šâ•â•â–‘â–‘â•šâ•â•â•â•šâ•â•â–‘â–‘â•šâ•â•â–‘â•šâ•â•â•â•â•â•â–‘â–‘â–‘â–‘â•šâ•â•â–‘â–‘â–‘â€ƒâ€ƒâ•šâ•â•â•â•â•â•â–‘â–‘â•šâ•â•â•â•â•â–‘â–‘â–‘â–‘â•šâ•â•â–‘â–‘â–‘


    """
    print(f"{Fore.GREEN}{banner:^80}{Style.RESET_ALL}")
    print(f"{Fore.GREEN}{'â•' * BORDER_WIDTH}{Style.RESET_ALL}")
    print_border("SNOONAUT BOT", Fore.GREEN)
    print(f"{Fore.YELLOW}â”‚ {'LiÃªn há»‡ / Contact'}: {Fore.CYAN}https://t.me/thog099{Style.RESET_ALL}")
    print(f"{Fore.YELLOW}â”‚ {'Discord'}: {Fore.CYAN}https://discord.gg/MnmYBKfHQf{Style.RESET_ALL}")
    print(f"{Fore.YELLOW}â”‚ {'Channel Telegram'}: {Fore.CYAN}https://t.me/thogairdrops{Style.RESET_ALL}")
    print(f"{Fore.GREEN}{'â•' * BORDER_WIDTH}{Style.RESET_ALL}")

# HÃ m xÃ³a mÃ n hÃ¬nh
def _clear():
    os.system('cls' if os.name == 'nt' else 'clear')

# CÃ¡c hÃ m giáº£ láº­p cho cÃ¡c lá»‡nh (cáº§n triá»ƒn khai thá»±c táº¿)
async def run_checkin(language: str):
    from scripts.checkin import run_checkin as checkin_run
    await checkin_run(language)

async def run_autotask(language: str):
    from scripts.autotask import run_autotask as autotask_run
    await autotask_run(language)

async def run_autotaskref(language: str):
    from scripts.autotaskref import run_autotaskref as autotaskref_run
    await autotaskref_run(language)

async def run_submitsol(language: str):
    from scripts.submitsol import run_submitsol as submitsol_run
    await submitsol_run(language)


async def cmd_exit(language: str):
    print_border(f"Exiting...", Fore.GREEN)
    sys.exit(0)

# Danh sÃ¡ch lá»‡nh menu
SCRIPT_MAP = {
    "checkin": run_checkin,
    "autotask": run_autotask,
    "autotaskref": run_autotaskref,
    "submitsol": run_submitsol,

    "exit": cmd_exit
}

def get_available_scripts(language):
    scripts = {
        'vi': [
            {"name": "1. Checkin háº±ng ngÃ y | Snoonaut Bot", "value": "checkin", "locked": True},
            {"name": "2. Tá»± Ä‘á»™ng hoÃ n thÃ nh nhiá»‡m vá»¥ [ Twitter | Discord | Telegram... ] | Snoonaut Bot", "value": "autotask", "locked": True},
            {"name": "3. Tá»± Ä‘á»™ng hoÃ n thÃ nh ngÆ°á»i giá»›i thiá»‡u [ Invite: 2 - 5 - 10... ] | Snoonaut Bot", "value": "autotaskref"},
            {"name": "4. Tá»± Ä‘á»™ng submit vÃ­ sol (address.txt) | Snoonaut Bot", "value": "submitsol", "locked": True},

            {"name": "5. Exit", "value": "exit"},
            
        ],
        'en': [          
            {"name": "1. Daily Checkin | Snoonaut Bot", "value": "checkin", "locked": True},
            {"name": "2. Auto tasks [ Twitter | Discord | Telegram... ] | Snoonaut Bot", "value": "autotask", "locked": True},
            {"name": "3. Auto tasks Referral [ Invite: 2 - 5 - 10... ] | Snoonaut Bot", "value": "autotaskref"},
            {"name": "4. Auto Submit Wallet Sol (address.txt) | Snoonaut Bot", "value": "submitsol", "locked": True},
            
            {"name": "5. Exit", "value": "exit"},
        ]
    }
    return scripts[language]

def run_script(script_func, language):
    """Cháº¡y script báº¥t ká»ƒ nÃ³ lÃ  async hay khÃ´ng."""
    if asyncio.iscoroutinefunction(script_func):
        asyncio.run(script_func(language))
    else:
        script_func(language)

def select_language():
    while True:
        _clear()
        _banner()
        print(f"{Fore.GREEN}{'â•' * BORDER_WIDTH}{Style.RESET_ALL}")
        print_border("CHá»ŒN NGÃ”N NGá»® / SELECT LANGUAGE", Fore.YELLOW)
        questions = [
            inquirer.List('language',
                          message=f"{Fore.CYAN}Vui lÃ²ng chá»n / Please select:{Style.RESET_ALL}",
                          choices=[("1. Tiáº¿ng Viá»‡t", 'vi'), ("2. English", 'en')],
                          carousel=True)
        ]
        answer = inquirer.prompt(questions)
        if answer and answer['language'] in ['vi', 'en']:
            return answer['language']
        print(f"{Fore.RED}âŒ {'Lá»±a chá»n khÃ´ng há»£p lá»‡ / Invalid choice':^76}{Style.RESET_ALL}")

def main():
    _clear()
    _banner()
    language = select_language()

    messages = {
        "vi": {
            "running": "Äang thá»±c thi: {}",
            "completed": "ÄÃ£ hoÃ n thÃ nh: {}",
            "error": "Lá»—i: {}",
            "press_enter": "Nháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...",
            "menu_title": "MENU CHÃNH",
            "select_script": "Chá»n script Ä‘á»ƒ cháº¡y",
            "locked": "ğŸ”’ Script nÃ y bá»‹ khÃ³a! Vui lÃ²ng vÃ o group hoáº·c Role Discord [ OG - Donate ] Ä‘á»ƒ má»Ÿ khÃ³a."
        },
        "en": {
            "running": "Running: {}",
            "completed": "Completed: {}",
            "error": "Error: {}",
            "press_enter": "Press Enter to continue...",
            "menu_title": "MAIN MENU",
            "select_script": "Select script to run",
            "locked": "ğŸ”’ This script is locked! Please join the discord group or role [ OG - Donate ] to unlock."
        }
    }

    while True:
        _clear()
        _banner()
        print(f"{Fore.YELLOW}{'â•' * BORDER_WIDTH}{Style.RESET_ALL}")
        print_border(messages[language]["menu_title"], Fore.YELLOW)
        print(f"{Fore.CYAN}â”‚ {messages[language]['select_script'].center(BORDER_WIDTH - 4)} â”‚{Style.RESET_ALL}")

        available_scripts = get_available_scripts(language)
        questions = [
            inquirer.List('script',
                          message=f"{Fore.CYAN}{messages[language]['select_script']}{Style.RESET_ALL}",
                          choices=[script["name"] for script in available_scripts],
                          carousel=True)
        ]
        answers = inquirer.prompt(questions)
        if not answers:
            continue

        selected_script_name = answers['script']
        selected_script = next(script for script in available_scripts if script["name"] == selected_script_name)
        selected_script_value = selected_script["value"]

        if selected_script.get("locked"):
            _clear()
            _banner()
            print_border("SCRIPT Bá»Š KHÃ“A / LOCKED", Fore.RED)
            print(f"{Fore.YELLOW}{messages[language]['locked']}")
            print('')
            print(f"{Fore.CYAN}â†’ Telegram: https://t.me/thogairdrops")
            print(f"{Fore.CYAN}â†’ Donate: https://buymecafe.vercel.app{Style.RESET_ALL}")
            print('')
            input(f"{Fore.YELLOW}â {messages[language]['press_enter']}{Style.RESET_ALL:^76}")
            continue

        script_func = SCRIPT_MAP.get(selected_script_value)
        if script_func is None:
            print(f"{Fore.RED}{'â•' * BORDER_WIDTH}{Style.RESET_ALL}")
            print_border(f"{'ChÆ°a triá»ƒn khai / Not implemented'}: {selected_script_name}", Fore.RED)
            input(f"{Fore.YELLOW}â {messages[language]['press_enter']}{Style.RESET_ALL:^76}")
            continue

        try:
            print(f"{Fore.CYAN}{'â•' * BORDER_WIDTH}{Style.RESET_ALL}")
            print_border(messages[language]["running"].format(selected_script_name), Fore.CYAN)
            run_script(script_func, language)
            print(f"{Fore.GREEN}{'â•' * BORDER_WIDTH}{Style.RESET_ALL}")
            print_border(messages[language]["completed"].format(selected_script_name), Fore.GREEN)
            input(f"{Fore.YELLOW}â {messages[language]['press_enter']}{Style.RESET_ALL:^76}")
        except Exception as e:
            print(f"{Fore.RED}{'â•' * BORDER_WIDTH}{Style.RESET_ALL}")
            print_border(messages[language]["error"].format(str(e)), Fore.RED)
            print('')
            input(f"{Fore.YELLOW}â {messages[language]['press_enter']}{Style.RESET_ALL:^76}")

if __name__ == "__main__":
    main()
